"use strict";(()=>{var T=(t,n)=>()=>(t&&(n=t(t=0)),n);var W=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var E=(t,n,r)=>new Promise((l,f)=>{var h=a=>{try{i(r.next(a))}catch(v){f(v)}},c=a=>{try{i(r.throw(a))}catch(v){f(v)}},i=a=>a.done?l(a.value):Promise.resolve(a.value).then(h,c);i((r=r.apply(t,n)).next())});var X,R,U=T(()=>{"use strict";X=t=>{let n=new ArrayBuffer(t.byteLength);return new Uint8Array(n).set(new Uint8Array(t)),n},R=X});var Y,G,$=T(()=>{"use strict";Y=(t,n)=>{let r=Math.sqrt(n),l=440,f=Math.pow(2,1/12),h=Math.floor((t-1)/r)+1;t=t-h*5-17;let c=a=>a%7===0,i=Math.floor(t/7+2)*5;return c(t+7)?t=t+i:c(t+6)?t=t+i+1:c(t+5)||c(t+4)?t=t+i+2:c(t+3)?t=t+i+3:c(t+2)?t=t+i+4:c(t+1)&&(t=t+i+5),[+(l*Math.pow(f,t)).toFixed(4),+(l*Math.pow(f,t+3)).toFixed(4)]},G=Y});var Z,F,_=T(()=>{"use strict";Z=(t,n,r)=>{let l=Math.sqrt(t),f=r+l-1,h=r+l,c=r+l+1,i=r-1,a=r+1,v=r-l-1,w=r-l,M=r-l+1;return[f,h,c,i,a,v,w,M].map(u=>n.includes(u)).filter(u=>u!==!1)},F=Z});var p=W(A=>{U();$();_();document.addEventListener("DOMContentLoaded",()=>E(A,null,function*(){let t=[...document.querySelectorAll(".pad")],n=[],r=document.querySelector(".grid"),l=t.length,f=document.querySelector(".playButton"),h=document.querySelector(".resetButton"),c=document.querySelector(".modeButton"),i=document.querySelector(".aboutButton"),a=document.querySelector(".closeButton"),v=document.querySelector(".creditsButton"),w=3,M=2500,u=!1,S,q=0,g=[],C="Classic",N="Random",d=N,j=["sawtooth","sine","square","triangle"],z=yield(yield fetch(`${window.location.href.includes("file")?"https://cors-anywhere.herokuapp.com/":""}https://jameslewis.io/assets/wav.wav`)).arrayBuffer(),L,P,k=()=>{f.innerHTML=u?"Stop":"Play",r.className=u?"main grid playing":"main grid",c.className=u?"modeButton playing":"modeButton"},B=()=>{u=!1,clearInterval(S),k(),n.forEach(e=>e.classList.remove("active")),q=0,g=[],n=[]},V=()=>{if(++q,g.push(n),g.length>2){g.shift();let[e,o]=g.map(s=>s.map(y=>y.id).length>0?s.map(y=>y.id).reduce((y,b)=>y+b):"empty");e===o&&B()}},H=()=>E(A,null,function*(){L=new window.AudioContext;let e=L.createGain();e.gain.value=.05,e.connect(L.destination);let o=L.createConvolver(),s=R(z.slice(0));o.buffer=yield L.decodeAudioData(s),o.connect(e),P=o}),x=e=>E(A,null,function*(){let o=L.createOscillator();o.type=j[Math.floor(Math.random()*4)],o.frequency.setValueAtTime(e,L.currentTime),o.connect(P),o.start(),yield new Promise(m=>setTimeout(m,M)).then(()=>{o.stop(),o.disconnect()})}),D=(e,o)=>{u||(n.includes(e)?(n=n.filter(s=>s!==e),e.classList.remove("active")):(n.push(e),e.classList.add("active"),x(o))),u&&x(o)};t.forEach((e,o)=>{let s=l-o,[m,y]=G(s,l);e.id=`${s}`,e.addEventListener("click",()=>{let b=Math.floor(q/4)%2===0?m:y;L===void 0?H().then(()=>D(e,b)):D(e,b)})});let J=(e,o,s,m)=>{!s&&m===w||s&&(m===w||m===w-1)?(n.includes(e)||n.push(e),s||e.classList.add("active"),e.click()):(n=n.filter(y=>y!==e),s&&e.classList.remove("active"))},K=(e,o,s)=>{Math.floor(Math.random()*10)===0?(n.includes(e)||n.push(e),s||e.classList.add("active"),e.click()):(n=n.filter(m=>m!==e),s&&e.classList.remove("active"))},O=()=>{let e=n.map(o=>+o.id);t.forEach((o,s)=>{let m=o.classList.contains("active"),y=F(l,e,+o.id).length;d===C&&J(o,s,m,y),d===N&&K(o,s,m)}),V()},Q=()=>{u===!0?(O(),S=setInterval(()=>O(),M)):clearInterval(S)};f==null||f.addEventListener("click",()=>{u=!u,k(),Q()}),h==null||h.addEventListener("click",()=>{B()}),c==null||c.addEventListener("click",()=>{L===void 0&&H(),d===C?d=N:d=C,c.innerHTML=`Mode: ${d}`}),i==null||i.addEventListener("click",()=>{var e;(e=document.querySelector(".modal"))==null||e.classList.add("showModal")}),a==null||a.addEventListener("click",()=>{var e;(e=document.querySelector(".modal"))==null||e.classList.remove("showModal")}),v==null||v.addEventListener("click",()=>{let e=document.querySelector(".credits");e==null||e.classList.toggle("showCredits"),(e==null?void 0:e.classList.contains("showCredits"))===!0&&window.scrollTo(0,document.body.scrollHeight)})}))});p();})();
