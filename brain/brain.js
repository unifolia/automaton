"use strict";(()=>{var M=(e,t)=>()=>(e&&(t=e(e=0)),t);var $=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var w=(e,t,r)=>new Promise((o,a)=>{var u=s=>{try{g(r.next(s))}catch(l){a(l)}},i=s=>{try{g(r.throw(s))}catch(l){a(l)}},g=s=>s.done?o(s.value):Promise.resolve(s.value).then(u,i);g((r=r.apply(e,t)).next())});var j,P,S=M(()=>{"use strict";j=(e,t)=>{let r=Math.sqrt(t),o=440,a=Math.pow(2,1/12),u=Math.floor((e-1)/r)+1;e=e-u*5-17;let i=Math.floor(e/7+2);return(e+7)%7===0?e=e+i*5:(e+6)%7===0?e=e+i*5+1:(e+5)%7===0||(e+4)%7===0?e=e+i*5+2:(e+3)%7===0?e=e+i*5+3:(e+2)%7===0?e=e+i*5+4:(e+1)%7===0&&(e=e+i*5+5),[+(o*Math.pow(a,e)).toFixed(4),+(o*Math.pow(a,e+3)).toFixed(4)]},P=j});var z,T,q=M(()=>{"use strict";z=(e,t,r)=>{let o=Math.sqrt(e),a=r+o-1,u=r+o,i=r+o+1,g=r-1,s=r+1,l=r-o-1,b=r-o,h=r-o+1;return[a,u,i,g,s,l,b,h].map(v=>t.includes(v)).filter(v=>v!==!1)},T=z});var E,k,H=M(()=>{"use strict";E=class{constructor(t){this.types=["sawtooth","sine","square","triangle"],this.audioContext=new window.AudioContext,this.oscillatorEngine=this.audioContext.createOscillator(),this.oscillatorEngine.type=this.types[Math.floor(Math.random()*4)],this.oscillatorEngine.frequency.setValueAtTime(t,this.audioContext.currentTime),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=.1,this.gainNode.connect(this.audioContext.destination),console.log(this.audioContext,"create audio context")}},k=E});var V,D,O=M(()=>{"use strict";V=e=>{let t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t},D=V});var J,x,G=M(()=>{"use strict";H();O();J=(e,t,r)=>w(void 0,null,function*(){let o=new k(e),a=()=>w(void 0,null,function*(){let s=o.audioContext.createConvolver(),l=D(t.slice(0));return s.buffer=yield o.audioContext.decodeAudioData(l),s});console.log(o.audioContext.state,"reverb created");let u=yield a();u.connect(o.gainNode),o.oscillatorEngine.connect(u),o.oscillatorEngine.start(),console.log(o.audioContext.state,"started"),yield new Promise(s=>setTimeout(s,r*.85)).then(()=>{o.oscillatorEngine.stop(),o.oscillatorEngine.disconnect()}),console.log(o.audioContext.state,"note stopped"),yield new Promise(s=>setTimeout(s,r*1.45)).then(()=>{o.audioContext.close()}),console.log(o.audioContext.state,"reverb stopped / closed")}),x=J});var K=$(R=>{S();q();G();document.addEventListener("DOMContentLoaded",()=>w(R,null,function*(){let e=[...document.querySelectorAll(".pad")],t=[],r=document.querySelector(".grid"),o=e.length,a=document.querySelector(".playButton"),u=document.querySelector(".resetButton"),i=document.querySelector(".modeButton"),g=3,s=2500,l="Mode: Classic",b,h=!1,v=0,d=[],p=window.location.href.includes("file")?"https://cors-anywhere.herokuapp.com/":"",C=yield(yield fetch(`${p}https://jameslewis.io/assets/Output%201-2.wav`)).arrayBuffer(),A=()=>{a.innerHTML=h?"Stop":"Play",r.className=h?"main grid playing":"main grid",i.className=h?"modeButton playing":"modeButton"},B=()=>{h=!1,clearInterval(b),A(),t.forEach(n=>{n.classList.remove("active")}),v=0,d=[],t=[]},F=()=>{if(++v,d.push(t),d.length>2){d.shift();let[n,f]=d.map(c=>c.map(y=>y.id).length>0?c.map(y=>y.id).reduce((y,L)=>y+L):"empty");n===f&&B()}},U=(n,f,c,m)=>{!c&&m===g||c&&(m===g||m===g-1)?(t.includes(n)||t.push(n),c||n.classList.add("active"),n.click()):(t=t.filter(y=>y!==n),c&&n.classList.remove("active"))},_=(n,f,c)=>{Math.floor(Math.random()*10)===0?(t.includes(n)||t.push(n),c||n.classList.add("active"),n.click()):(t=t.filter(m=>m!==n),c&&n.classList.remove("active"))};e.forEach((n,f)=>{let c=o-f,[m,y]=P(c,o);n.id=`${c}`,n.addEventListener("click",()=>{h||(t.includes(n)?(t=t.filter(L=>L!==n),n.classList.remove("active")):(t.push(n),n.classList.add("active"),x(m,C,s))),h&&(Math.floor(v/4)%2===0?x(m,C,s):x(y,C,s))})});let N=()=>{let n=t.map(f=>+f.id);e.forEach((f,c)=>{let m=f.classList.contains("active"),y=T(o,n,+f.id).length;l==="Mode: Classic"&&U(f,c,m,y),l==="Mode: Random"&&_(f,c,m)}),F()};a==null||a.addEventListener("click",()=>{h=!h,A(),h===!0?(N(),b=setInterval(()=>N(),s)):clearInterval(b)}),u==null||u.addEventListener("click",()=>{B()}),i==null||i.addEventListener("click",()=>{l==="Mode: Random"?l="Mode: Classic":l="Mode: Random",i.innerHTML=l})}))});K();})();
