"use strict";(()=>{var N=(e,n)=>()=>(e&&(n=e(e=0)),n);var Q=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var E=(e,n,r)=>new Promise((l,m)=>{var v=a=>{try{y(r.next(a))}catch(h){m(h)}},i=a=>{try{y(r.throw(a))}catch(h){m(h)}},y=a=>a.done?l(a.value):Promise.resolve(a.value).then(v,i);y((r=r.apply(e,n)).next())});var W,x,R=N(()=>{"use strict";W=e=>{let n=new ArrayBuffer(e.byteLength);return new Uint8Array(n).set(new Uint8Array(e)),n},x=W});var X,O,G=N(()=>{"use strict";X=(e,n)=>{let r=Math.sqrt(n),l=440,m=Math.pow(2,1/12),v=Math.floor((e-1)/r)+1;e=e-v*5-17;let i=Math.floor(e/7+2);return(e+7)%7===0?e=e+i*5:(e+6)%7===0?e=e+i*5+1:(e+5)%7===0||(e+4)%7===0?e=e+i*5+2:(e+3)%7===0?e=e+i*5+3:(e+2)%7===0?e=e+i*5+4:(e+1)%7===0&&(e=e+i*5+5),[+(l*Math.pow(m,e)).toFixed(4),+(l*Math.pow(m,e+3)).toFixed(4)]},O=X});var Y,U,$=N(()=>{"use strict";Y=(e,n,r)=>{let l=Math.sqrt(e),m=r+l-1,v=r+l,i=r+l+1,y=r-1,a=r+1,h=r-l-1,f=r-l,b=r-l+1;return[m,v,i,y,a,h,f,b].map(g=>n.includes(g)).filter(g=>g!==!1)},U=Y});var Z=Q(A=>{R();G();$();document.addEventListener("DOMContentLoaded",()=>E(A,null,function*(){let e=[...document.querySelectorAll(".pad")],n=[],r=document.querySelector(".grid"),l=e.length,m=document.querySelector(".playButton"),v=document.querySelector(".resetButton"),i=document.querySelector(".modeButton"),y="Classic",a="Random",h="MIDI",f=y,b=3,g=2500,M=!1,T,B=0,d=[],F=["sawtooth","sine","square","triangle"],_=yield(yield fetch(`${window.location.href.includes("file")?"https://cors-anywhere.herokuapp.com/":""}https://jameslewis.io/assets/Output%201-2.wav`)).arrayBuffer(),L,P,C=()=>{m.innerHTML=M?"Stop":"Play",r.className=M?"main grid playing":"main grid",i.className=M?"modeButton playing":"modeButton"},S=()=>{M=!1,clearInterval(T),C(),n.forEach(t=>t.classList.remove("active")),B=0,d=[],n=[]},j=()=>{if(++B,d.push(n),d.length>2){d.shift();let[t,o]=d.map(s=>s.map(u=>u.id).length>0?s.map(u=>u.id).reduce((u,w)=>u+w):"empty");t===o&&S()}},z=()=>{navigator==null||navigator.requestMIDIAccess().then(t=>{t.inputs.forEach(o=>o.onmidimessage=s=>{let[c]=e.filter(u=>+u.id===s.data[1]-42);c&&f===h&&c.click()})},null)},k=()=>E(A,null,function*(){L=new window.AudioContext;let t=L.createGain();t.gain.value=.0666,t.connect(L.destination);let o=L.createConvolver(),s=x(_.slice(0));o.buffer=yield L.decodeAudioData(s),o.connect(t),P=o,z()}),q=t=>E(A,null,function*(){let o=L.createOscillator();o.type=F[Math.floor(Math.random()*4)],o.frequency.setValueAtTime(t,L.currentTime),o.connect(P),o.start(),yield new Promise(c=>setTimeout(c,g)).then(()=>{o.stop(),o.disconnect()})}),D=(t,o)=>{M||(n.includes(t)?(n=n.filter(s=>s!==t),t.classList.remove("active")):(n.push(t),t.classList.add("active"),q(o))),M&&q(o)};e.forEach((t,o)=>{let s=l-o,[c,u]=O(s,l);t.id=`${s}`,t.addEventListener("click",()=>{let w=Math.floor(B/4)%2===0?c:u;L===void 0?k().then(()=>D(t,w)):D(t,w)})});let V=(t,o,s,c)=>{!s&&c===b||s&&(c===b||c===b-1)?(n.includes(t)||n.push(t),s||t.classList.add("active"),t.click()):(n=n.filter(u=>u!==t),s&&t.classList.remove("active"))},J=(t,o,s)=>{Math.floor(Math.random()*10)===0?(n.includes(t)||n.push(t),s||t.classList.add("active"),t.click()):(n=n.filter(c=>c!==t),s&&t.classList.remove("active"))},H=()=>{let t=n.map(o=>+o.id);e.forEach((o,s)=>{let c=o.classList.contains("active"),u=U(l,t,+o.id).length;f===y&&V(o,s,c,u),f===a&&J(o,s,c)}),j()},K=()=>{M===!0?(H(),T=setInterval(()=>H(),g)):clearInterval(T)};m==null||m.addEventListener("click",()=>{M=!M,C(),K()}),v==null||v.addEventListener("click",()=>{S()}),i==null||i.addEventListener("click",()=>{L===void 0&&k(),f===y?f=a:f===a?(f=h,document.body.classList.add(h)):(f=y,document.body.classList.remove(h)),i.innerHTML=`Mode: ${f}`})}))});Z();})();
