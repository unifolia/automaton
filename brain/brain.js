"use strict";(()=>{var C=(e,n)=>()=>(e&&(n=e(e=0)),n);var Q=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var E=(e,n,r)=>new Promise((c,u)=>{var y=f=>{try{h(r.next(f))}catch(l){u(l)}},i=f=>{try{h(r.throw(f))}catch(l){u(l)}},h=f=>f.done?c(f.value):Promise.resolve(f.value).then(y,i);h((r=r.apply(e,n)).next())});var W,H,R=C(()=>{"use strict";W=e=>{let n=new ArrayBuffer(e.byteLength);return new Uint8Array(n).set(new Uint8Array(e)),n},H=W});var X,O,G=C(()=>{"use strict";X=(e,n)=>{let r=Math.sqrt(n),c=440,u=Math.pow(2,1/12),y=Math.floor((e-1)/r)+1;e=e-y*5-17;let i=Math.floor(e/7+2);return(e+7)%7===0?e=e+i*5:(e+6)%7===0?e=e+i*5+1:(e+5)%7===0||(e+4)%7===0?e=e+i*5+2:(e+3)%7===0?e=e+i*5+3:(e+2)%7===0?e=e+i*5+4:(e+1)%7===0&&(e=e+i*5+5),[+(c*Math.pow(u,e)).toFixed(4),+(c*Math.pow(u,e+3)).toFixed(4)]},O=X});var Y,U,$=C(()=>{"use strict";Y=(e,n,r)=>{let c=Math.sqrt(e),u=r+c-1,y=r+c,i=r+c+1,h=r-1,f=r+1,l=r-c-1,L=r-c,b=r-c+1;return[u,y,i,h,f,l,L,b].map(v=>n.includes(v)).filter(v=>v!==!1)},U=Y});var Z=Q(N=>{R();G();$();document.addEventListener("DOMContentLoaded",()=>E(N,null,function*(){let e=[...document.querySelectorAll(".pad")],n=[],r=document.querySelector(".grid"),c=e.length,u=document.querySelector(".playButton"),y=document.querySelector(".resetButton"),i=document.querySelector(".modeButton"),h=3,f=2500,l=!1,L,b=0,v=[],w="Classic",P="Random",d="MIDI",M=w,F=["sawtooth","sine","square","triangle"],_=yield(yield fetch(`${window.location.href.includes("file")?"https://cors-anywhere.herokuapp.com/":""}https://jameslewis.io/assets/Output%201-2.wav`)).arrayBuffer(),g,T,k=()=>{u.innerHTML=l?"Stop":"Play",r.className=l?"main grid playing":"main grid",i.className=l?"modeButton playing":"modeButton"},B=()=>{l=!1,clearInterval(L),k(),n.forEach(t=>t.classList.remove("active")),b=0,v=[],n=[]},j=()=>{if(++b,v.push(n),v.length>2){v.shift();let[t,o]=v.map(s=>s.map(m=>m.id).length>0?s.map(m=>m.id).reduce((m,A)=>m+A):"empty");t===o&&B()}},z=()=>{navigator==null||navigator.requestMIDIAccess().then(t=>{t.inputs.forEach(o=>o.onmidimessage=s=>{let a=s.data[1];if(s.data.length===3&&M===d)e[64-(a-35)].click();else return})},null)},D=()=>E(N,null,function*(){g=new window.AudioContext;let t=g.createGain();t.gain.value=.0666,t.connect(g.destination);let o=g.createConvolver(),s=H(_.slice(0));o.buffer=yield g.decodeAudioData(s),o.connect(t),T=o,z()}),S=t=>E(N,null,function*(){let o=g.createOscillator();o.type=F[Math.floor(Math.random()*4)],o.frequency.setValueAtTime(t,g.currentTime),o.connect(T),o.start(),yield new Promise(a=>setTimeout(a,f)).then(()=>{o.stop(),o.disconnect()})}),q=(t,o)=>{l||(n.includes(t)?(n=n.filter(s=>s!==t),t.classList.remove("active")):(n.push(t),t.classList.add("active"),S(o))),l&&S(o)};e.forEach((t,o)=>{let s=c-o,[a,m]=O(s,c);t.id=`${s}`,t.addEventListener("click",()=>{let A=Math.floor(b/4)%2===0?a:m;g===void 0?D().then(()=>q(t,A)):q(t,A)})});let V=(t,o,s,a)=>{!s&&a===h||s&&(a===h||a===h-1)?(n.includes(t)||n.push(t),s||t.classList.add("active"),t.click()):(n=n.filter(m=>m!==t),s&&t.classList.remove("active"))},J=(t,o,s)=>{Math.floor(Math.random()*10)===0?(n.includes(t)||n.push(t),s||t.classList.add("active"),t.click()):(n=n.filter(a=>a!==t),s&&t.classList.remove("active"))},x=()=>{let t=n.map(o=>+o.id);e.forEach((o,s)=>{let a=o.classList.contains("active"),m=U(c,t,+o.id).length;M===w&&V(o,s,a,m),M===P&&J(o,s,a)}),j()},K=()=>{l===!0?(x(),L=setInterval(()=>x(),f)):clearInterval(L)};u==null||u.addEventListener("click",()=>{l=!l,k(),K()}),y==null||y.addEventListener("click",()=>{B()}),i==null||i.addEventListener("click",()=>{g===void 0&&D(),M===w?M=P:M===P?(M=d,document.body.classList.add(d)):(M=w,document.body.classList.remove(d)),i.innerHTML=`Mode: ${M}`})}))});Z();})();
