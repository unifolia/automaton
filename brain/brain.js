"use strict";(()=>{var C=(e,n)=>()=>(e&&(n=e(e=0)),n);var Q=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var E=(e,n,r)=>new Promise((l,f)=>{var y=m=>{try{h(r.next(m))}catch(a){f(a)}},i=m=>{try{h(r.throw(m))}catch(a){f(a)}},h=m=>m.done?l(m.value):Promise.resolve(m.value).then(y,i);h((r=r.apply(e,n)).next())});var W,H,R=C(()=>{"use strict";W=e=>{let n=new ArrayBuffer(e.byteLength);return new Uint8Array(n).set(new Uint8Array(e)),n},H=W});var X,O,G=C(()=>{"use strict";X=(e,n)=>{let r=Math.sqrt(n),l=440,f=Math.pow(2,1/12),y=Math.floor((e-1)/r)+1;e=e-y*5-17;let i=Math.floor(e/7+2);return(e+7)%7===0?e=e+i*5:(e+6)%7===0?e=e+i*5+1:(e+5)%7===0||(e+4)%7===0?e=e+i*5+2:(e+3)%7===0?e=e+i*5+3:(e+2)%7===0?e=e+i*5+4:(e+1)%7===0&&(e=e+i*5+5),[+(l*Math.pow(f,e)).toFixed(4),+(l*Math.pow(f,e+3)).toFixed(4)]},O=X});var Y,U,$=C(()=>{"use strict";Y=(e,n,r)=>{let l=Math.sqrt(e),f=r+l-1,y=r+l,i=r+l+1,h=r-1,m=r+1,a=r-l-1,L=r-l,b=r-l+1;return[f,y,i,h,m,a,L,b].map(v=>n.includes(v)).filter(v=>v!==!1)},U=Y});var Z=Q(N=>{R();G();$();document.addEventListener("DOMContentLoaded",()=>E(N,null,function*(){let e=[...document.querySelectorAll(".pad")],n=[],r=document.querySelector(".grid"),l=e.length,f=document.querySelector(".playButton"),y=document.querySelector(".resetButton"),i=document.querySelector(".modeButton"),h=3,m=2500,a=!1,L,b=0,v=[],d="Classic",P="Random",w="MIDI",M=d,F=["sawtooth","sine","square","triangle"],_=yield(yield fetch(`${window.location.href.includes("file")?"https://cors-anywhere.herokuapp.com/":""}https://jameslewis.io/assets/Output%201-2.wav`)).arrayBuffer(),g,T,B=()=>{f.innerHTML=a?"Stop":"Play",r.className=a?"main grid playing":"main grid",i.className=a?"modeButton playing":"modeButton"},D=()=>{a=!1,clearInterval(L),B(),n.forEach(t=>t.classList.remove("active")),b=0,v=[],n=[]},j=()=>{if(++b,v.push(n),v.length>2){v.shift();let[t,o]=v.map(s=>s.map(u=>u.id).length>0?s.map(u=>u.id).reduce((u,A)=>u+A):"empty");t===o&&D()}},z=()=>{navigator==null||navigator.requestMIDIAccess().then(t=>{t.inputs.forEach(o=>o.onmidimessage=s=>{let[c]=e.filter(u=>+u.id===s.data[1]-35);c&&M===w&&c.click()})},null)},S=()=>E(N,null,function*(){g=new window.AudioContext;let t=g.createGain();t.gain.value=.0666,t.connect(g.destination);let o=g.createConvolver(),s=H(_.slice(0));o.buffer=yield g.decodeAudioData(s),o.connect(t),T=o,z()}),k=t=>E(N,null,function*(){let o=g.createOscillator();o.type=F[Math.floor(Math.random()*4)],o.frequency.setValueAtTime(t,g.currentTime),o.connect(T),o.start(),yield new Promise(c=>setTimeout(c,m)).then(()=>{o.stop(),o.disconnect()})}),q=(t,o)=>{a||(n.includes(t)?(n=n.filter(s=>s!==t),t.classList.remove("active")):(n.push(t),t.classList.add("active"),k(o))),a&&k(o)};e.forEach((t,o)=>{let s=l-o,[c,u]=O(s,l);t.id=`${s}`,t.addEventListener("click",()=>{let A=Math.floor(b/4)%2===0?c:u;g===void 0?S().then(()=>q(t,A)):q(t,A)})});let V=(t,o,s,c)=>{!s&&c===h||s&&(c===h||c===h-1)?(n.includes(t)||n.push(t),s||t.classList.add("active"),t.click()):(n=n.filter(u=>u!==t),s&&t.classList.remove("active"))},J=(t,o,s)=>{Math.floor(Math.random()*10)===0?(n.includes(t)||n.push(t),s||t.classList.add("active"),t.click()):(n=n.filter(c=>c!==t),s&&t.classList.remove("active"))},x=()=>{let t=n.map(o=>+o.id);e.forEach((o,s)=>{let c=o.classList.contains("active"),u=U(l,t,+o.id).length;M===d&&V(o,s,c,u),M===P&&J(o,s,c)}),j()},K=()=>{a===!0?(x(),L=setInterval(()=>x(),m)):clearInterval(L)};f==null||f.addEventListener("click",()=>{a=!a,B(),K()}),y==null||y.addEventListener("click",()=>{D()}),i==null||i.addEventListener("click",()=>{g===void 0&&S(),M===d?M=P:M===P?(M=w,document.body.classList.add(w)):(M=d,document.body.classList.remove(w)),i.innerHTML=`Mode: ${M}`})}))});Z();})();
