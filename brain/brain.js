"use strict";(()=>{var P=(t,n)=>()=>(t&&(n=t(t=0)),n);var Y=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var S=(t,n,r)=>new Promise((l,f)=>{var d=a=>{try{i(r.next(a))}catch(h){f(h)}},c=a=>{try{i(r.throw(a))}catch(h){f(h)}},i=a=>a.done?l(a.value):Promise.resolve(a.value).then(d,c);i((r=r.apply(t,n)).next())});var Z,U,G=P(()=>{"use strict";Z=t=>{let n=new ArrayBuffer(t.byteLength);return new Uint8Array(n).set(new Uint8Array(t)),n},U=Z});var p,$,F=P(()=>{"use strict";p=(t,n)=>{let r=Math.sqrt(n),l=440,f=Math.pow(2,1/12),d=Math.floor((t-1)/r)+1;t=t-d*5-17;let c=Math.floor(t/7+2)*5,i=a=>a%7===0;return i(t+7)?t=t+c:i(t+6)?t=t+c+1:i(t+5)||i(t+4)?t=t+c+2:i(t+3)?t=t+c+3:i(t+2)?t=t+c+4:i(t+1)&&(t=t+c+5),[+(l*Math.pow(f,t)).toFixed(4),+(l*Math.pow(f,t+3)).toFixed(4)]},$=p});var I,_,j=P(()=>{"use strict";I=(t,n,r)=>{let l=Math.sqrt(t),f=r+l-1,d=r+l,c=r+l+1,i=r-1,a=r+1,h=r-l-1,g=r-l,w=r-l+1;return[f,d,c,i,a,h,g,w].map(u=>n.includes(u)).filter(u=>u!==!1)},_=I});var ee=Y(q=>{G();F();j();document.addEventListener("DOMContentLoaded",()=>S(q,null,function*(){let t=[...document.querySelectorAll(".pad")],n=[],r=document.querySelector(".grid"),l=t.length,f=document.querySelector(".playButton"),d=document.querySelector(".resetButton"),c=document.querySelector(".modeButton"),i=document.querySelector(".aboutButton"),a=document.querySelector(".closeButton"),h=document.querySelector(".creditsButton"),g=3,w=2500,u=!1,C,k=0,M=[],b="Classic",N="Random",E="MIDI",v=b,z=["sawtooth","sine","square","triangle"],V=yield(yield fetch(`${window.location.href.includes("file")?"https://cors-anywhere.herokuapp.com/":""}https://jameslewis.io/assets/wav.wav`)).arrayBuffer(),L,T,B=()=>{f.innerHTML=u?"Stop":"Play",r.className=u?"main grid playing":"main grid",c.className=u?"modeButton playing":"modeButton"},D=()=>{u=!1,clearInterval(C),B(),n.forEach(e=>e.classList.remove("active")),k=0,M=[],n=[]},J=()=>{if(++k,M.push(n),M.length>2){M.shift();let[e,o]=M.map(s=>s.map(y=>y.id).length>0?s.map(y=>y.id).reduce((y,A)=>y+A):"empty");e===o&&D()}},K=()=>{navigator==null||navigator.requestMIDIAccess().then(e=>{e.inputs.forEach(o=>o.onmidimessage=s=>{if(s.data.length===3&&v===E)t[64-(s.data[1]-35)].click();else return})},null)},H=()=>S(q,null,function*(){L=new window.AudioContext;let e=L.createGain();e.gain.value=.05,e.connect(L.destination);let o=L.createConvolver(),s=U(V.slice(0));o.buffer=yield L.decodeAudioData(s),o.connect(e),T=o,K()}),x=e=>S(q,null,function*(){let o=L.createOscillator();o.type=z[Math.floor(Math.random()*4)],o.frequency.setValueAtTime(e,L.currentTime),o.connect(T),o.start(),yield new Promise(m=>setTimeout(m,w)).then(()=>{o.stop(),o.disconnect()})}),R=(e,o)=>{u||(n.includes(e)?(n=n.filter(s=>s!==e),e.classList.remove("active")):(n.push(e),e.classList.add("active"),x(o))),u&&x(o)};t.forEach((e,o)=>{let s=l-o,[m,y]=$(s,l);e.id=`${s}`,e.addEventListener("click",()=>{let A=Math.floor(k/4)%2===0?m:y;L===void 0?H().then(()=>R(e,A)):R(e,A)})});let Q=(e,o,s,m)=>{!s&&m===g||s&&(m===g||m===g-1)?(n.includes(e)||n.push(e),s||e.classList.add("active"),e.click()):(n=n.filter(y=>y!==e),s&&e.classList.remove("active"))},W=(e,o,s)=>{Math.floor(Math.random()*10)===0?(n.includes(e)||n.push(e),s||e.classList.add("active"),e.click()):(n=n.filter(m=>m!==e),s&&e.classList.remove("active"))},O=()=>{let e=n.map(o=>+o.id);t.forEach((o,s)=>{let m=o.classList.contains("active"),y=_(l,e,+o.id).length;v===b&&Q(o,s,m,y),v===N&&W(o,s,m)}),J()},X=()=>{u===!0?(O(),C=setInterval(()=>O(),w)):clearInterval(C)};f==null||f.addEventListener("click",()=>{u=!u,B(),X()}),d==null||d.addEventListener("click",()=>{D()}),c==null||c.addEventListener("click",()=>{L===void 0&&H(),v===b?v=N:v===N?(v=E,document.body.classList.add(E)):(v=b,document.body.classList.remove(E)),c.innerHTML=`Mode: ${v}`}),i==null||i.addEventListener("click",()=>{var e;(e=document.querySelector(".modal"))==null||e.classList.add("showModal")}),a==null||a.addEventListener("click",()=>{var e;(e=document.querySelector(".modal"))==null||e.classList.remove("showModal")}),h==null||h.addEventListener("click",()=>{let e=document.querySelector(".credits");e==null||e.classList.toggle("showCredits"),(e==null?void 0:e.classList.contains("showCredits"))===!0&&window.scrollTo(0,document.body.scrollHeight)})}))});ee();})();
