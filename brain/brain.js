"use strict";(()=>{var C=(e,n)=>()=>(e&&(n=e(e=0)),n);var j=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var d=(e,n,s)=>new Promise((c,u)=>{var h=l=>{try{v(s.next(l))}catch(f){u(f)}},i=l=>{try{v(s.throw(l))}catch(f){u(f)}},v=l=>l.done?c(l.value):Promise.resolve(l.value).then(h,i);v((s=s.apply(e,n)).next())});var z,k,x=C(()=>{"use strict";z=e=>{let n=new ArrayBuffer(e.byteLength);return new Uint8Array(n).set(new Uint8Array(e)),n},k=z});var V,H,D=C(()=>{"use strict";V=(e,n)=>{let s=Math.sqrt(n),c=440,u=Math.pow(2,1/12),h=Math.floor((e-1)/s)+1;e=e-h*5-17;let i=Math.floor(e/7+2);return(e+7)%7===0?e=e+i*5:(e+6)%7===0?e=e+i*5+1:(e+5)%7===0||(e+4)%7===0?e=e+i*5+2:(e+3)%7===0?e=e+i*5+3:(e+2)%7===0?e=e+i*5+4:(e+1)%7===0&&(e=e+i*5+5),[+(c*Math.pow(u,e)).toFixed(4),+(c*Math.pow(u,e+3)).toFixed(4)]},H=V});var J,O,R=C(()=>{"use strict";J=(e,n,s)=>{let c=Math.sqrt(e),u=s+c-1,h=s+c,i=s+c+1,v=s-1,l=s+1,f=s-c-1,m=s-c,g=s-c+1;return[u,h,i,v,l,f,m,g].map(L=>n.includes(L)).filter(L=>L!==!1)},O=J});var K=j(A=>{x();D();R();document.addEventListener("DOMContentLoaded",()=>d(A,null,function*(){let e=[...document.querySelectorAll(".pad")],n=[],s=document.querySelector(".grid"),c=e.length,u=document.querySelector(".playButton"),h=document.querySelector(".resetButton"),i=document.querySelector(".modeButton"),v=3,l=2500,f="Mode: Classic",m=!1,g,L=0,w=[],G=["sawtooth","sine","square","triangle"],F=yield(yield fetch(`${window.location.href.includes("file")?"https://cors-anywhere.herokuapp.com/":""}https://jameslewis.io/assets/Output%201-2.wav`)).arrayBuffer(),M,N,S=()=>{u.innerHTML=m?"Stop":"Play",s.className=m?"main grid playing":"main grid",i.className=m?"modeButton playing":"modeButton"},T=()=>{m=!1,clearInterval(g),S(),n.forEach(t=>t.classList.remove("active")),L=0,w=[],n=[]},U=()=>{if(++L,w.push(n),w.length>2){w.shift();let[t,o]=w.map(r=>r.map(y=>y.id).length>0?r.map(y=>y.id).reduce((y,E)=>y+E):"empty");t===o&&T()}},_=(t,o,r,a)=>{!r&&a===v||r&&(a===v||a===v-1)?(n.includes(t)||n.push(t),r||t.classList.add("active"),t.click()):(n=n.filter(y=>y!==t),r&&t.classList.remove("active"))},$=(t,o,r)=>{Math.floor(Math.random()*10)===0?(n.includes(t)||n.push(t),r||t.classList.add("active"),t.click()):(n=n.filter(a=>a!==t),r&&t.classList.remove("active"))},B=()=>d(A,null,function*(){M=new window.AudioContext;let t=M.createGain();t.gain.value=.12,t.connect(M.destination);let o=M.createConvolver(),r=k(F.slice(0));o.buffer=yield M.decodeAudioData(r),o.connect(t),N=o}),P=t=>d(A,null,function*(){let o=M.createOscillator();o.type=G[Math.floor(Math.random()*4)],o.frequency.setValueAtTime(t,M.currentTime),o.connect(N),o.start(),yield new Promise(a=>setTimeout(a,l*.85)).then(()=>{o.stop(),o.disconnect()})}),q=(t,o)=>{m||(n.includes(t)?(n=n.filter(r=>r!==t),t.classList.remove("active")):(n.push(t),t.classList.add("active"),P(o))),m&&P(o)};e.forEach((t,o)=>{let r=c-o,[a,y]=H(r,c);t.id=`${r}`,t.addEventListener("click",()=>{let E=Math.floor(L/4)%2===0?a:y;M===void 0?B().then(()=>q(t,E)):q(t,E)})});let b=()=>{let t=n.map(o=>+o.id);e.forEach((o,r)=>{let a=o.classList.contains("active"),y=O(c,t,+o.id).length;f==="Mode: Classic"&&_(o,r,a,y),f==="Mode: Random"&&$(o,r,a)}),U()};u==null||u.addEventListener("click",()=>{m=!m,S(),M===void 0?B().then(()=>{m===!0?(b(),g=setInterval(()=>b(),l)):clearInterval(g)}):m===!0?(b(),g=setInterval(()=>b(),l)):clearInterval(g)}),h==null||h.addEventListener("click",()=>{T()}),i==null||i.addEventListener("click",()=>{f==="Mode: Random"?f="Mode: Classic":f="Mode: Random",i.innerHTML=f})}))});K();})();
