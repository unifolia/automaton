"use strict";(()=>{var P=(s,t)=>()=>(s&&(t=s(s=0)),t);var Y=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var E=(s,t,r)=>new Promise((i,m)=>{var y=c=>{try{f(r.next(c))}catch(d){m(d)}},u=c=>{try{f(r.throw(c))}catch(d){m(d)}},f=c=>c.done?i(c.value):Promise.resolve(c.value).then(y,u);f((r=r.apply(s,t)).next())});var Z,j,R=P(()=>{"use strict";Z=s=>{let t=new ArrayBuffer(s.byteLength);return new Uint8Array(t).set(new Uint8Array(s)),t},j=Z});var I,F,G=P(()=>{"use strict";I=(s,t=0,r=0)=>{let m=Math.pow(2,.08333333333333333),y={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],dorian:[0,2,3,5,7,9,10],mixolydian:[0,2,4,5,7,9,10],pentatonic:[0,2,4,7,9],blues:[0,3,5,6,7,10]},u=Object.keys(y),f=r<u.length?u[r]:"major",c=y[f],d=c.length,L=s-1,b=L%d,a=Math.floor(L/d),h=60+t+c[b]+a*12;return[+(440*Math.pow(m,h-90)).toFixed(4)]},F=I});var ee,U,$=P(()=>{"use strict";ee=(s,t,r)=>{let i=Math.sqrt(s),m=r+i-1,y=r+i,u=r+i+1,f=r-1,c=r+1,d=r-i-1,L=r-i,b=r-i+1;return[m,y,u,f,c,d,L,b].map(a=>t.includes(a)).filter(a=>a!==!1)},U=ee});var te=Y(A=>{R();G();$();document.addEventListener("DOMContentLoaded",()=>E(A,null,function*(){let s=[...document.querySelectorAll(".pad")],t=[],r=document.querySelector(".grid"),i=s.length,m=document.querySelector(".playButton"),y=document.querySelector(".resetButton"),u=document.querySelector(".modeButton"),f=document.querySelector(".aboutButton"),c=document.querySelector(".closeButton"),d=document.querySelector(".creditsButton"),L=3,b=2500,a=!1,p,h=0,w=[],C=0,S=0,q="Classic",N="Random",M=N,K=["sawtooth","sine","square","triangle"],_=yield(yield fetch(`${window.location.href.includes("localhost")?"https://cors-anywhere.herokuapp.com/":""}https://jameslewis.io/assets/wav.wav`)).arrayBuffer(),v,k,T=()=>{m.innerHTML=a?"Stop":"Play",r.className=a?"main grid playing":"main grid",u.className=a?"modeButton playing":"modeButton"},B=()=>{a=!1,clearInterval(p),T(),t.forEach(e=>e.classList.remove("active")),h=0,w=[],t=[]},z=()=>{if(h%8===0&&h>0){let e=[0,7,2,9,4,11,6,1];C=e[Math.floor(h/8)%e.length]}h%4===0&&h>0&&(S=(S+1)%3)},V=()=>{if(++h,w.push(t),z(),w.length>2){w.shift();let[e,n]=w.map(o=>o.map(g=>g.id).length>0?o.map(g=>g.id).reduce((g,X)=>g+X):"empty");e===n&&B()}},H=()=>E(A,null,function*(){v=new window.AudioContext;let e=v.createGain();e.gain.value=.05,e.connect(v.destination);let n=v.createConvolver(),o=j(_.slice(0));n.buffer=yield v.decodeAudioData(o),n.connect(e),k=n}),x=e=>E(A,null,function*(){let n=v.createOscillator();n.type=K[Math.floor(Math.random()*4)],n.frequency.setValueAtTime(e,v.currentTime),n.connect(k),n.start(),yield new Promise(l=>setTimeout(l,b)).then(()=>{n.stop(),n.disconnect()})}),D=(e,n)=>{a||(t.includes(e)?(t=t.filter(o=>o!==e),e.classList.remove("active")):(t.push(e),e.classList.add("active"),x(n))),a&&x(n)};s.forEach((e,n)=>{let o=i-n;e.id=`${o}`,e.addEventListener("click",()=>{let[l]=F(o,C,S);v===void 0?H().then(()=>D(e,l)):D(e,l)})});let J=(e,n,o,l)=>{!o&&l===L||o&&(l===L||l===L-1)?(t.includes(e)||t.push(e),o||e.classList.add("active"),e.click()):(t=t.filter(g=>g!==e),o&&e.classList.remove("active"))},Q=(e,n,o)=>{Math.floor(Math.random()*6)===0?(t.includes(e)||t.push(e),o||e.classList.add("active"),e.click()):(t=t.filter(l=>l!==e),o&&e.classList.remove("active"))},O=()=>{let e=t.map(n=>+n.id);s.forEach((n,o)=>{let l=n.classList.contains("active"),g=U(i,e,+n.id).length;M===q&&J(n,o,l,g),M===N&&Q(n,o,l)}),V()},W=()=>{a===!0?(O(),p=setInterval(()=>O(),b)):clearInterval(p)};m==null||m.addEventListener("click",()=>{a=!a,T(),W()}),y==null||y.addEventListener("click",()=>{B()}),u==null||u.addEventListener("click",()=>{v===void 0&&H(),M===q?M=N:M=q,u.innerHTML=`Mode: ${M}`}),f==null||f.addEventListener("click",()=>{var e;(e=document.querySelector(".modal"))==null||e.classList.add("showModal")}),c==null||c.addEventListener("click",()=>{var e;(e=document.querySelector(".modal"))==null||e.classList.remove("showModal")}),d==null||d.addEventListener("click",()=>{let e=document.querySelector(".credits");e==null||e.classList.toggle("showCredits"),(e==null?void 0:e.classList.contains("showCredits"))===!0&&window.scrollTo(0,document.body.scrollHeight)})}))});te();})();
