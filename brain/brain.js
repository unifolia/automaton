"use strict";(()=>{var k=(e,n)=>()=>(e&&(n=e(e=0)),n);var X=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var S=(e,n,r)=>new Promise((i,u)=>{var y=l=>{try{h(r.next(l))}catch(d){u(d)}},c=l=>{try{h(r.throw(l))}catch(d){u(d)}},h=l=>l.done?i(l.value):Promise.resolve(l.value).then(y,c);h((r=r.apply(e,n)).next())});var Y,O,G=k(()=>{"use strict";Y=e=>{let n=new ArrayBuffer(e.byteLength);return new Uint8Array(n).set(new Uint8Array(e)),n},O=Y});var Z,U,$=k(()=>{"use strict";Z=(e,n)=>{let r=Math.sqrt(n),i=440,u=Math.pow(2,1/12),y=Math.floor((e-1)/r)+1;e=e-y*5-17;let c=Math.floor(e/7+2);return(e+7)%7===0?e=e+c*5:(e+6)%7===0?e=e+c*5+1:(e+5)%7===0||(e+4)%7===0?e=e+c*5+2:(e+3)%7===0?e=e+c*5+3:(e+2)%7===0?e=e+c*5+4:(e+1)%7===0&&(e=e+c*5+5),[+(i*Math.pow(u,e)).toFixed(4),+(i*Math.pow(u,e+3)).toFixed(4)]},U=Z});var p,F,_=k(()=>{"use strict";p=(e,n,r)=>{let i=Math.sqrt(e),u=r+i-1,y=r+i,c=r+i+1,h=r-1,l=r+1,d=r-i-1,b=r-i,m=r-i+1;return[u,y,c,h,l,d,b,m].map(M=>n.includes(M)).filter(M=>M!==!1)},F=p});var I=X(q=>{G();$();_();document.addEventListener("DOMContentLoaded",()=>S(q,null,function*(){let e=[...document.querySelectorAll(".pad")],n=[],r=document.querySelector(".grid"),i=e.length,u=document.querySelector(".playButton"),y=document.querySelector(".resetButton"),c=document.querySelector(".modeButton"),h=document.querySelector(".aboutButton"),l=document.querySelector(".closeButton"),d=3,b=2500,m=!1,M,N=0,g=[],w="Classic",P="Random",E="MIDI",v=w,j=["sawtooth","sine","square","triangle"],z=yield(yield fetch(`${window.location.href.includes("file")?"https://cors-anywhere.herokuapp.com/":""}https://jameslewis.io/assets/Output%201-2.wav`)).arrayBuffer(),L,C,T=()=>{u.innerHTML=m?"Stop":"Play",r.className=m?"main grid playing":"main grid",c.className=m?"modeButton playing":"modeButton"},B=()=>{m=!1,clearInterval(M),T(),n.forEach(t=>t.classList.remove("active")),N=0,g=[],n=[]},V=()=>{if(++N,g.push(n),g.length>2){g.shift();let[t,o]=g.map(s=>s.map(f=>f.id).length>0?s.map(f=>f.id).reduce((f,A)=>f+A):"empty");t===o&&B()}},J=()=>{navigator==null||navigator.requestMIDIAccess().then(t=>{t.inputs.forEach(o=>o.onmidimessage=s=>{if(s.data.length===3&&v===E)e[64-(s.data[1]-35)].click();else return})},null)},D=()=>S(q,null,function*(){L=new window.AudioContext;let t=L.createGain();t.gain.value=.0666,t.connect(L.destination);let o=L.createConvolver(),s=O(z.slice(0));o.buffer=yield L.decodeAudioData(s),o.connect(t),C=o,J()}),x=t=>S(q,null,function*(){let o=L.createOscillator();o.type=j[Math.floor(Math.random()*4)],o.frequency.setValueAtTime(t,L.currentTime),o.connect(C),o.start(),yield new Promise(a=>setTimeout(a,b)).then(()=>{o.stop(),o.disconnect()})}),H=(t,o)=>{m||(n.includes(t)?(n=n.filter(s=>s!==t),t.classList.remove("active")):(n.push(t),t.classList.add("active"),x(o))),m&&x(o)};e.forEach((t,o)=>{let s=i-o,[a,f]=U(s,i);t.id=`${s}`,t.addEventListener("click",()=>{let A=Math.floor(N/4)%2===0?a:f;L===void 0?D().then(()=>H(t,A)):H(t,A)})});let K=(t,o,s,a)=>{!s&&a===d||s&&(a===d||a===d-1)?(n.includes(t)||n.push(t),s||t.classList.add("active"),t.click()):(n=n.filter(f=>f!==t),s&&t.classList.remove("active"))},Q=(t,o,s)=>{Math.floor(Math.random()*10)===0?(n.includes(t)||n.push(t),s||t.classList.add("active"),t.click()):(n=n.filter(a=>a!==t),s&&t.classList.remove("active"))},R=()=>{let t=n.map(o=>+o.id);e.forEach((o,s)=>{let a=o.classList.contains("active"),f=F(i,t,+o.id).length;v===w&&K(o,s,a,f),v===P&&Q(o,s,a)}),V()},W=()=>{m===!0?(R(),M=setInterval(()=>R(),b)):clearInterval(M)};u==null||u.addEventListener("click",()=>{m=!m,T(),W()}),y==null||y.addEventListener("click",()=>{B()}),c==null||c.addEventListener("click",()=>{L===void 0&&D(),v===w?v=P:v===P?(v=E,document.body.classList.add(E)):(v=w,document.body.classList.remove(E)),c.innerHTML=`Mode: ${v}`}),h==null||h.addEventListener("click",()=>{var t;(t=document.querySelector(".modal"))==null||t.classList.add("showModal")}),l==null||l.addEventListener("click",()=>{var t;(t=document.querySelector(".modal"))==null||t.classList.remove("showModal")})}))});I();})();
